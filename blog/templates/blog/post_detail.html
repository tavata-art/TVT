{% extends 'core/base.html' %}
{% load static %}
{% load i18n %}
{% load blog_tags %}

{# SEO blocks to override the defaults from base.html #}
{% block seo_title %}{{ post.meta_title|default:post.title }}{% endblock %}
{% block seo_description %}{{ post.meta_description|default:"" }}{% endblock %}

{# This block sets the browser tab's title #}
{% block title %}{{ post.title }}{% endblock %}


{% block content %}
<div class="container mt-5">
    <div class="row">
        {# Use a centered, medium-width column for better text readability #}
        <div class="col-lg-8 mx-auto">

            {# 1. Featured Image: Only displayed if the post has one #}
            {% if post.featured_image %}
                <img src="{{ post.featured_image.url }}" class="img-fluid rounded mb-4 shadow" alt="{{ post.title }}">
            {% endif %}

            {# 2. Post Title (from the database, already multilingual) #}
            <h1 class="display-4 fw-bold">{{ post.title }}</h1>

            {# 3. Post Metadata: Date and Author (Internationalized) #}
            <p class="lead text-muted">
                {% firstof post.author.get_full_name post.author.username as author_name %}
                {% blocktranslate with published_date=post.published_date|date:"DATE_FORMAT" author=author_name %}
                Published on {{ published_date }} by {{ author }}
                {% endblocktranslate %}
            </p>

            {# 4. Post Categories: Only displayed if categories are assigned #}
            {% if post.categories.exists %}
                <div class="mb-3">
                    <strong>{% translate "Categories" %}:</strong>
                    {% for category in post.categories.all %}
                        <a href="{% url 'blog:posts_by_category' category.slug %}" class="badge bg-tavata-yellow text-dark text-decoration-none">
                            {{ category.name }}
                        </a>
                    {% endfor %}
                </div>
            {% endif %}

            {# A horizontal rule to separate header from content #}
            <hr class="my-4">

            {# 5. Main Post Content (from the database, already multilingual) #}
            {# The |safe filter is crucial to render the HTML from the WYSIWYG editor correctly. #}
            <div class="post-content fs-5">
                {{ post.content|safe }}
            </div>

        </div>
    </div>
</div>
{% endblock %}

{% block sidebar_right %}
    {# The 'sticky-top' class makes the sidebar "stick" to the top of the viewport once you scroll past it. #}
    {# We still add 'pt-5' (padding-top) to align it correctly at the start. #}
    <div class="sticky-top pt-5">
        {% show_recent_posts %}
        {% show_blog_categories %}
    </div>
{% endblock %}