<!-- File: menus/templates/menus/partials/_navbar_menu.html -->
{% load menu_tags %} {# Nos cargamos a nosotros mismos para la recursi√≥n #}

{% for node in nodes %}
    {% with children=node.children.all %}
        {# Check if this item is a dropdown #}
        {% if children %}
            {# If it's a top-level item, it's a standard dropdown #}
            {% if not node.parent %}
                <li class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle" href="#" id="navbar-dd-{{ node.id }}" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                        {{ node.title }}
                    </a>
                    <ul class="dropdown-menu" aria-labelledby="navbar-dd-{{ node.id }}">
                        {# Render the children #}
                        {% include "menus/partials/_navbar_menu_children.html" with nodes=children %}
                    </ul>
                </li>
            {% endif %}
        {% else %}
            {# This is a simple link item without children #}
            {% if node.parent %}
                {# This is a child item inside a dropdown #}
                <li><a class="dropdown-item" href="{{ node.get_url }}">{{ node.title }}</a></li>
            {% else %}
                {# This is a top-level link in the main navbar #}
                <li class="nav-item">
                    <a class="nav-link" href="{{ node.get_url }}">{{ node.title }}</a>
                </li>
            {% endif %}
        {% endif %}
    {% endwith %}
{% endfor %}