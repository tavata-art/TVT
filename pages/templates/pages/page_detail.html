{% extends 'core/base.html' %}
{% load i18n %}
{% load static %}
{% load widget_tags %}
{% load mptt_tags %}

{# --- Page Metadata Blocks --- #}
{# This block is used to set the page's metadata for SEO purposes. #}
{% block meta %}
    <meta name="description" content="{{ page.meta_description|default:page.title }}">
    <meta name="keywords" content="{{ page.meta_keywords|default:"" }}">
    <meta property="og:title" content="{{ page.title }}">
    <meta property="og:description" content="{{ page.meta_description|default:page.title }}">
    <meta property="og:type" content="article">
    <meta property="og:url" content="{{ request.build_absolute_uri }}">
{% endblock meta %}

{# --- SEO and Browser Tab Title Blocks --- #}
{# Override the base templates SEO blocks with this page's specific data #}
{% block seo_title %}{{ page.meta_title|default:page.title }}{% endblock %}
{% block seo_description %}{{ page.meta_description|default:"" }}{% endblock %}

{# This block sets the browser tab's title #}
{% block title %}{{ page.title }}{% endblock %}


{% block content %}
<div class="container mt-5">
    {# Check if the 'page' object was passed from the view. #}
    {# This is a safeguard for the homepage if no page is marked as such. #}
    {% if page %}
        <div class="row">
            {# Use a centered, medium-width column for better text readability #}
            <div class="col-lg-10 mx-auto">

                {# 1. Page Title (from database, already multilingual) #}
                <h1 class="display-4 fw-bold">{{ page.title }}</h1>
                
                {# 2. Page Metadata (Author and Last Updated timestamp) #}
                <p class="lead text-muted">
                    {# Use 'firstof' to safely get the author's name #}
                    {% firstof page.author.get_full_name page.author.username as author_name %}
                    {# The entire sentence is wrapped in blocktranslate for proper localization #}
                    {% blocktranslate with author=author_name updated_date=page.updated_at|date:"DATE_FORMAT" %}
                        By {{ author }} | Last updated: {{ updated_date }}
                    {% endblocktranslate %}
                </p>

                {# 3. Page Categories, displayed only if they exist #}
                {% if page.categories.exists %}
                    <div class="mb-3">
                        <strong>{% translate "Categories" %}:</strong>
                        {% for category in page.categories.all %}
                            <a href="{% url 'pages:pages_by_category' category.slug %}" class="badge bg-tavata-yellow text-dark text-decoration-none">
                                {{ category.name }}
                            </a>
                        {% endfor %}
                    </div>
                {% endif %}

                {# A horizontal rule to separate the header from the main content #}
                <hr class="my-4">

                {# 4. Main Page Content (from database, already multilingual) #}
                {# The |safe filter is crucial for rendering HTML from the WYSIWYG editor #}
                <div class="page-content fs-5">
                    {{ page.content|safe }}
                </div>

            </div>
        </div>
    {% else %}
        {# This block is shown if no homepage is set in the database. #}
        <div class="text-center">
            <h1 class="display-3">{% translate "Welcome!" %}</h1>
            <p class="lead">{% translate "Site under construction. Please configure a homepage from the admin panel." %}</p>
        </div>
    {% endif %}
</div>
{% endblock %}

{# --- SIDEBAR DINÁMICO PARA LA PÁGINA --- #}
{# --- Left Sidebar --- #}
{% block sidebar_left %}
    {% if page and page.is_homepage %}
        <div class="sticky-top pt-5">
            {# 2. Llamamos a la zona de widgets para el sidebar izquierdo del blog #}
            {% show_widget_zone 'homepage-sidebar-left' %}
        </div>
    {% endif %}
{% endblock sidebar_left %}

{# Este bloque se renderizará en el sidebar derecho definido en base.html #}
{% block sidebar_right %}
    {% if page and page.is_homepage %}
        <div class="sticky-top pt-5">
            {# Llamamos a la zona de widgets específica para la homepage #}
            {% show_widget_zone 'homepage-sidebar-right' %}
        </div>
    {% endif %}
{% endblock sidebar_right %}